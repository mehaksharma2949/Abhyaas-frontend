<!DOCTYPE html>
<html lang="en">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<head>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Lesson Planner • Lesson Plan Generator</title>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Inter, system-ui, Arial; }
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #a8e6f0 0%, #7dd3dd 100%);
      color: #1a1a1a;
      display: flex;
      justify-content: center;
      padding: 30px 14px;
    }
    .wrap { width: 100%; max-width: 980px; display: grid; gap: 16px; }
    .top { display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; }
    .brand { display: flex; align-items: center; gap: 12px; }
    .icon {
      width: 52px; height: 52px; border-radius: 16px;
      background: linear-gradient(135deg, #4a9eff, #00d4ff);
      display: grid; place-items: center;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      font-size: 22px;
    }
    .title h1 { font-size: 22px; color: #1a5f7a; }
    .title p { opacity: 0.7; font-size: 13px; margin-top: 2px; color: #2a2a2a; }

    .card {
      background: rgba(255,255,255,0.85);
      border: 1px solid rgba(255,255,255,0.6);
      border-radius: 22px;
      padding: 18px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter: blur(12px);
    }

    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    @media (max-width: 820px) { .grid { grid-template-columns: 1fr; } }

    label { font-size: 13px; opacity: 0.8; display: block; margin-bottom: 8px; color: #2a2a2a; font-weight: 500; }
    input, select, textarea {
      width: 100%; padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.9);
      color: #1a1a1a; outline: none;
      font-size: 14px;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #4a9eff;
    }
    textarea { min-height: 90px; resize: vertical; }

    .btnRow { display: flex; gap: 12px; margin-top: 14px; flex-wrap: wrap; }
    button {
      border: none; cursor: pointer;
      border-radius: 16px;
      padding: 12px 16px;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
    }
    .primary {
      background: linear-gradient(135deg, #4a9eff, #00d4ff);
      color: white;
    }
    .primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(74, 158, 255, 0.4);
    }
    .ghost {
      background: rgba(0,0,0,0.05);
      color: #2a2a2a;
      border: 1px solid rgba(0,0,0,0.1);
    }
    .ghost:hover {
      background: rgba(0,0,0,0.08);
    }

    .outHead { display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; margin-bottom: 10px; }
    .outHead h2 { font-size: 16px; color: #1a5f7a; }
    .pill {
      font-size: 12px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(74, 158, 255, 0.15);
      border: 1px solid rgba(74, 158, 255, 0.25);
      color: #1a5f7a;
      opacity: 0.9;
    }

    .output { white-space: pre-wrap; line-height: 1.55; font-size: 14px; opacity: 0.9; color: #2a2a2a; }
    .loading { display: none; gap: 10px; align-items: center; margin-top: 12px; opacity: 0.9; font-size: 13px; color: #2a2a2a; }
    .dot { width: 10px; height: 10px; border-radius: 999px; background: #4a9eff; animation: bounce 0.8s infinite alternate; }
    .dot:nth-child(2) { animation-delay: 0.15s; }
    .dot:nth-child(3) { animation-delay: 0.30s; }
    @keyframes bounce { from { transform: translateY(0); opacity: 0.4; } to { transform: translateY(-8px); opacity: 1; } }

    .danger { color: #ff4444; font-size: 13px; margin-top: 10px; display: none; }
    .note { font-size: 12px; opacity: 0.7; margin-top: 10px; color: #2a2a2a; }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="top">
      <div class="brand">
        <div class="icon">⛓️</div>
        <div class="title">
          <h1>Smart Lesson Planner</h1>
          <p>Creates structured Bloom's Taxonomy lesson plans in seconds.</p>
        </div>
      </div>
      <!-- <div class="pill">FastAPI + OpenAI</div> -->
    </div>

    <div class="card">
      <div class="grid">
        <div>
          <label>Topic</label>
          <input id="topic" placeholder="e.g. Photosynthesis, Linear Regression, Data Structures" />
        </div>

        <div>
          <label>Grade / Class</label>
          <input id="grade" placeholder="e.g. Class 7, Grade 10, College 1st Year" />
        </div>

        <div>
          <label>Duration</label>
          <select id="duration">
            <option>30 minutes</option>
            <option selected>40 minutes</option>
            <option>45 minutes</option>
            <option>60 minutes</option>
            <option>90 minutes</option>
          </select>
        </div>

        <div>
          <label>Teaching Style</label>
          <select id="style">
            <option selected>Interactive</option>
            <option>Lecture</option>
            <option>Project Based</option>
            <option>Storytelling</option>
            <option>Activity Based</option>
          </select>
        </div>

        <div>
          <label>Difficulty</label>
          <select id="difficulty">
            <option>Easy</option>
            <option selected>Medium</option>
            <option>Hard</option>
          </select>
        </div>

        <div>
          <label>Extra Instructions (optional)</label>
          <textarea id="extra" placeholder="e.g. Add 5 MCQs, make it fun, include group activity..."></textarea>
        </div>
      </div>

      <div class="btnRow">
        <button class="primary" onclick="generatePlan()">Generate Lesson Plan</button>
        <button class="ghost" onclick="clearAll()">Clear</button>
        <button class="ghost" onclick="copyOutput()">Copy Output</button>
      </div>

      <div class="loading" id="loading">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        <div>Generating lesson plan...</div>
      </div>

      <div class="danger" id="err"></div>
      <div class="note">⚠️ Keep your OpenAI key only in backend (main.py). Never in frontend.</div>
    </div>

    <div class="card">
      <div class="outHead">
        <h2>Generated Lesson Plan</h2>
        <div class="pill" id="status">Ready</div>
      </div>

      <div class="output" id="output">Fill the form and click "Generate Lesson Plan".</div>
    </div>
<button class="ghost" onclick="downloadPDF()">Download PDF</button>
<button class="ghost" onclick="downloadImage()">Download Image</button>


  </div>
<script src="../config.js"></script>

<script>
  console.log("CONFIG:", window.APP_CONFIG);
</script>
  <script>
    const API_BASE = window.APP_CONFIG?.API_BASE || "https://backend-abhyaas-final.onrender.com";

    function setLoading(isLoading) {
      document.getElementById("loading").style.display = isLoading ? "flex" : "none";
      document.getElementById("status").innerText = isLoading ? "Working..." : "Ready";
    }

    function setError(msg) {
      const err = document.getElementById("err");
      if (!msg) {
        err.style.display = "none";
        err.innerText = "";
      } else {
        err.style.display = "block";
        err.innerText = msg;
      }
    }

    function escapeHtml(str) {
      return str.replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;");
    }

    async function generatePlan() {
      setError("");

      const topic = document.getElementById("topic").value.trim();
      const grade = document.getElementById("grade").value.trim();
      const duration = document.getElementById("duration").value;
      const style = document.getElementById("style").value;
      const difficulty = document.getElementById("difficulty").value;
      const extra = document.getElementById("extra").value.trim();

      if (!topic || !grade) {
        setError("Please enter Topic and Grade/Class.");
        return;
      }

      setLoading(true);

      try {
        const res = await fetch(API, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            topic,
            grade,
            duration,
            teaching_style: style,
            difficulty,
            extra
          })
        });

        const data = await res.json();

        if (!res.ok) {
          throw new Error(data?.detail || "Request failed.");
        }

        document.getElementById("output").innerHTML =
          escapeHtml(data.lesson_plan || "No response");

      } catch (e) {
        setError("Error: " + e.message);
      } finally {
        setLoading(false);
      }
    }

    function clearAll() {
      document.getElementById("topic").value = "";
      document.getElementById("grade").value = "";
      document.getElementById("extra").value = "";
      document.getElementById("output").innerText = "Fill the form and click \"Generate Lesson Plan\".";
      setError("");
    }

    async function copyOutput() {
      const text = document.getElementById("output").innerText.trim();
      if (!text) return;
      await navigator.clipboard.writeText(text);
      document.getElementById("status").innerText = "Copied ✅";
      setTimeout(() => document.getElementById("status").innerText = "Ready", 900);
    }
async function downloadPDF() {
  setError("");

  const topic = document.getElementById("topic").value.trim();
  const grade = document.getElementById("grade").value.trim();
  const duration = document.getElementById("duration").value;
  const style = document.getElementById("style").value;
  const difficulty = document.getElementById("difficulty").value;
  const extra = document.getElementById("extra").value.trim();

  if (!topic || !grade) {
    setError("Please enter Topic and Grade/Class.");
    return;
  }

  try {
    const res = await fetch("http://127.0.0.1:8000/download-pdf", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        topic,
        grade,
        duration,
        teaching_style: style,
        difficulty,
        extra
      })
    });

    if (!res.ok) throw new Error("PDF download failed.");

    const blob = await res.blob();
    const url = window.URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "LessonPlan.pdf";
    a.click();

    window.URL.revokeObjectURL(url);

  } catch (e) {
    setError("Error: " + e.message);
  }
}
async function downloadImage() {
  const node = document.querySelector(".card:last-child"); // output card

  const canvas = await html2canvas(node, { scale: 2 });
  const link = document.createElement("a");
  link.download = "LessonPlan.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
}

  </script>
</body>
</html>