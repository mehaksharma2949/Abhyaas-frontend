<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Abhyaas ‚Ä¢ Cartoon Video Generator</title>

  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:Inter,system-ui,Arial;}

    :root{
      --bg1:#eaf6ff;
      --bg2:#dff2ff;
      --bg3:#cfeaff;

      --card: rgba(255,255,255,0.78);
      --card2: rgba(255,255,255,0.60);
      --border: rgba(20,80,160,0.14);

      --text:#398ef5;
      --muted:#3d5877;

      --accent1:#5ad3ff;
      --accent2:#0ea5e9;
      --accent3:#0b3b82;

      --danger:#ef4444;
      --shadow: 0 26px 90px rgba(5, 40, 90, 0.18);
    }

    body{
      min-height:100vh;
      overflow:hidden;
      padding:18px;
      color:var(--text);
      font-weight:700;

      background: linear-gradient(120deg, var(--bg1), var(--bg2), var(--bg3), #f6fbff);
      background-size: 420% 420%;
      animation: bgmove 14s ease infinite;
    }
    


    @keyframes bgmove{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }

    /* ===== Study Icon Particles ===== */
    .particles{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:-1;
      opacity:1;
    }

    .p{
      position:absolute;
      font-size:28px;
      opacity:.35;
      filter: blur(.1px);
      animation: floaty 10s ease-in-out infinite;
      user-select:none;
    }

    .p.soft{opacity:.22;font-size:22px;}
    .p.big{opacity:.18;font-size:38px;}

    @keyframes floaty{
      0%,100%{ transform: translateY(0px) rotate(0deg) scale(1); }
      50%{ transform: translateY(-34px) rotate(8deg) scale(1.08); }
    }

    /* ===== Full Cover Layout ===== */
    .wrap{
      max-width:1200px;
      margin:0 auto;
      height:calc(100vh - 36px);
      display:grid;
      grid-template-rows:auto 1fr;
      gap:14px;
    }

    /* ===== Top Header ===== */
    .topbar{
      background: rgba(255,255,255,0.65);
      border:1px solid var(--border);
      border-radius:24px;
      padding:16px 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);

      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;

      animation: pop .55s ease;
    }

    @keyframes pop{
      from{transform: translateY(10px); opacity:0}
      to{transform: translateY(0); opacity:1}
    }

    .brand{
      display:flex;
      align-items:center;
      gap:14px;
      min-width: 280px;
      font-weight:750
    }

    .logo{
      width:52px;height:52px;border-radius:20px;
      background: linear-gradient(135deg, var(--accent1), var(--accent2), var(--accent3));
      box-shadow: 0 18px 60px rgba(14,165,233,.22);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      color:white;
      position:relative;
      overflow:hidden;
    }

    .logo::after{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle, rgba(255,255,255,.35), transparent 60%);
      opacity:.7;
      animation: glow 3.2s ease-in-out infinite;
    }

    @keyframes glow{
      0%,100%{transform:translate(-10px,-10px)}
      50%{transform:translate(10px,10px)}
    }

    .brand h1{font-size:24px;font-weight:1000;line-height:1.1;}
    .brand p{font-size:18px;color:var(--muted);font-weight:800;margin-top:3px;}

    .pillRow{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;}
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.75);
      border:1px solid rgba(14,165,233,.18);
      font-size:18px;
      font-weight:700;
      color:var(--text);
      box-shadow: 0 16px 45px rgba(0,0,0,.08);
      transition:.2s ease;
    }
    .pill:hover{transform: translateY(-2px);}

    /* ===== Main Cover Card ===== */
    .card{
      background: var(--card);
      border:1px solid var(--border);
      border-radius:30px;
      padding:22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      overflow:hidden;
      position:relative;
      animation: fadeUp .65s ease;
    }

    @keyframes fadeUp{
      from{transform: translateY(12px); opacity:0}
      to{transform: translateY(0); opacity:1}
    }

    /* Decorative gradient blob inside card */
    .card::before{
      content:"";
      position:absolute;
      width:520px;height:520px;
      right:-220px;top:-220px;
      background: radial-gradient(circle, rgba(90,211,255,.55), transparent 60%);
      filter: blur(10px);
      opacity:.7;
    }
    .card::after{
      content:"";
      position:absolute;
      width:520px;height:520px;
      left:-220px;bottom:-260px;
      background: radial-gradient(circle, rgba(14,165,233,.35), transparent 60%);
      filter: blur(10px);
      opacity:.6;
    }

    .inner{
      position:relative;
      height:100%;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:18px;
      align-items:stretch;
    }

    @media(max-width:980px){
      body{overflow:auto;}
      .wrap{height:auto;}
      .inner{grid-template-columns:1fr;}
    }

    /* ===== Left Panel ===== */
    .left{
      background: rgba(255,255,255,.55);
      border:1px solid rgba(14,165,233,.14);
      border-radius:26px;
      padding:20px;
      box-shadow: 0 18px 60px rgba(0,0,0,.08);
    }

    .title{
      font-size:28px;
      font-weight:750;
      color:var(--accent3);
      letter-spacing:-.2px;
    }

    .subtitle{
      margin-top:8px;
      font-size:13px;
      color:rgba(30,60,90,.75);
      font-weight:700;
      line-height:1.5;
    }

    .gridForm{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-top:16px;
    }
    @media(max-width:520px){
      .gridForm{grid-template-columns:1fr;}
    }

    label{
      font-size:18px;
      color:rgba(11,59,130,.88);
      font-weight:700;
      margin-bottom:6px;
      display:block;
    }

    input,select{
      width:100%;
      padding:13px 12px;
      border-radius:16px;
      border:1px solid rgba(11,59,130,.14);
      background: rgba(255,255,255,0.88);
      color:var(--text);
      outline:none;
      font-weight:900;
      transition:.2s ease;
    }

    input::placeholder{color:rgba(60,90,120,.55);font-weight:800}

    input:focus,select:focus{
      border-color: rgba(14,165,233,.45);
      box-shadow: 0 0 0 4px rgba(14,165,233,.14);
      transform: translateY(-1px);
    }

    .btn{
      width:100%;
      padding:15px 14px;
      border-radius:18px;
      border:0;
      cursor:pointer;
      font-weight:700;
      color:white;
      background: linear-gradient(135deg, var(--accent1), var(--accent2), var(--accent3));
      transition:.22s ease;
      box-shadow: 0 18px 55px rgba(14,165,233,.22);
      position:relative;
      overflow:hidden;
      margin-top:14px;
    }

    .btn::after{
      content:"";
      position:absolute;
      top:-40%;
      left:-40%;
      width:80%;
      height:200%;
      background:linear-gradient(90deg, transparent, rgba(255,255,255,.35), transparent);
      transform: rotate(20deg);
      opacity:0;
      transition:.35s ease;
    }

    .btn:hover{transform: translateY(-2px) scale(1.01);}
    .btn:hover::after{opacity:1;left:120%;}
    .btn:disabled{opacity:.6;cursor:not-allowed;transform:none;}

    .note{
      margin-top:14px;
      padding:14px;
      border-radius:18px;
      background: rgba(255,255,255,0.65);
      border:1px solid rgba(14,165,233,.14);
      font-size:18px;
      font-weight:700;
      color:rgba(30,60,90,.78);
      line-height:1.5;
    }

    /* ===== Right Panel (Preview / Status) ===== */
    .right{
      background: rgba(255,255,255,.50);
      border:1px solid rgba(14,165,233,.14);
      border-radius:26px;
      padding:18px;
      box-shadow: 0 18px 60px rgba(0,0,0,.08);
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height: 520px;
    }

    .rightTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    .rightTitle{
      font-weight:800;
      color:var(--accent3);
      font-size:20px;
    }
    *{ font-weight:600; }
    h1,h2,h3{
      font-weight:800;
      }



    .statusBadge{
      padding:10px 12px;
      border-radius:999px;
      font-size:18px;
      font-weight:700;
      background: rgba(255,255,255,.80);
      border:1px solid rgba(14,165,233,.18);
    }

    .progress{
      height:10px;
      background: rgba(11,59,130,.10);
      border-radius:999px;
      overflow:hidden;
    }

    .bar{
      height:10px;
      width:0%;
      background: linear-gradient(90deg, var(--accent1), var(--accent2), var(--accent3));
      transition: width .35s ease;
    }

    .hint{
      font-size:18px;
      font-weight:700;
      color:rgba(30,60,90,.75);
      line-height:1.4;
    }

    .links{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
    }

    a{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:12px 14px;
      border-radius:16px;
      background: rgba(255,255,255,0.88);
      border:1px solid rgba(14,165,233,.18);
      color:var(--accent3);
      font-weight:1000;
      text-decoration:none;
      transition:.2s ease;
    }
    a:hover{transform: translateY(-2px);}

    .dangerBtn{
      background: linear-gradient(135deg, #ff5a5a, #ef4444, #b91c1c);
      box-shadow: 0 18px 55px rgba(239,68,68,.18);
      color:white;
      border:none;
      padding:12px 14px;
      border-radius:16px;
      cursor:pointer;
      font-weight:700;
      transition:.2s ease;
    }
    .dangerBtn:hover{transform: translateY(-2px);}

    video{
      width:100%;
      border-radius:22px;
      border:1px solid rgba(14,165,233,.16);
      box-shadow: 0 25px 70px rgba(0,0,0,.16);
      display:none;
      animation: fadeUp .55s ease;
      margin-top:6px;
    }

    .emptyState{
      flex:1;
      border-radius:22px;
      border:2px dashed rgba(14,165,233,.28);
      background: rgba(255,255,255,.35);
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:20px;
      color:rgba(30,60,90,.75);
      font-weight:700;
      line-height:1.5;
    }

    .spark{
      width:64px;height:64px;border-radius:22px;
      background: linear-gradient(135deg, rgba(90,211,255,.8), rgba(14,165,233,.8), rgba(11,59,130,.9));
      display:flex;
      align-items:center;
      justify-content:center;
      color:white;
      box-shadow: 0 22px 70px rgba(14,165,233,.22);
      margin:0 auto 14px;
      animation: pulse 1.7s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{transform:scale(1)}
      50%{transform:scale(1.08)}
    }
  </style>
</head>

<body>

<!-- Study Icon Particles -->
<div class="particles">
  <div class="p big" style="left:4%; top:8%; animation-delay:.2s;">üìö</div>
  <div class="p" style="left:10%; top:22%; animation-delay:1.1s;">‚úèÔ∏è</div>
  <div class="p soft" style="left:6%; top:40%; animation-delay:2.2s;">üß†</div>
  <div class="p" style="left:8%; top:62%; animation-delay:.9s;">üßÆ</div>
  <div class="p big" style="left:5%; top:82%; animation-delay:1.6s;">üéì</div>

  <div class="p big" style="left:94%; top:10%; animation-delay:.7s;">üß™</div>
  <div class="p" style="left:90%; top:26%; animation-delay:1.9s;">üìñ</div>
  <div class="p soft" style="left:96%; top:44%; animation-delay:1.3s;">üìù</div>
  <div class="p" style="left:92%; top:68%; animation-delay:2.6s;">üî¨</div>
  <div class="p big" style="left:95%; top:86%; animation-delay:2.1s;">üìå</div>

  <div class="p soft" style="left:25%; top:6%; animation-delay:1.4s;">‚≠ê</div>
  <div class="p soft" style="left:70%; top:92%; animation-delay:2.8s;">‚ú®</div>
</div>

<div class="wrap">

  <div class="topbar">
    <div class="brand">
      <div class="logo">A</div>
      <div>
        <h1>Abhyaas ‚Ä¢ Cartoon Video Generator</h1>
        <p>Topic ‚Üí AI script ‚Üí voice ‚Üí scenes ‚Üí MP4 ready in minutes</p>
      </div>
    </div>

    <div class="pillRow">
      <div class="pill">‚ö° Fast Render</div>
      <div class="pill">üé¨ MP4 Export</div>
      <div class="pill">üìö Classroom-ready</div>
    </div>
  </div>

  <div class="card">
    <div class="inner">

      <!-- LEFT -->
      <div class="left">
        <div class="title">Generate an AI Video Lesson</div>
        <div class="subtitle">
          Enter topic, grade and language. Abhyaas will create a short animated explainer video with narration.
        </div>

        <div class="gridForm">

          <div style="grid-column:1/-1;">
            <label>Topic</label>
            <input id="topic" placeholder="Example: Fractions, LCM, Area, Water Cycle..." />
          </div>

          <div>
            <label>Grade</label>
            <select id="grade">
              <option value="" selected disabled>Select grade</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
            </select>
          </div>

          <div>
            <label>Language</label>
            <select id="language">
              <option value="" selected disabled>Select language</option>
              <option value="hinglish">Hinglish</option>
              <option value="english">English</option>
              <option value="hindi">Hindi</option>
            </select>
          </div>

          <div style="grid-column:1/-1;">
            <label>Video Style</label>
            <select id="style">
              <option>Cartoon Classroom</option>
              <option>Fun Explainer</option>
              <option>Teacher Mode</option>
            </select>
          </div>

        </div>

        <button class="btn" id="renderBtn" onclick="startRender()">üöÄ Generate Video</button>

        <div class="note">
          <!-- <b>Pro Tip:</b> Topic thoda clear likho. Example: ‚ÄúLCM with examples‚Äù or ‚ÄúWater Cycle (Class 5)‚Äù.
          Rendering time server GPU/CPU pe depend karta hai. -->
        </div>
      </div>

      <!-- RIGHT -->
      <div class="right">

        <div class="rightTop">
          <div class="rightTitle">Render Status & Preview</div>
          <div class="statusBadge" id="statusText">Status: Waiting</div>
        </div>

        <div class="progress">
          <div class="bar" id="progressBar"></div>
        </div>

        <div class="hint" id="statusHint">
          Generate video to start rendering. You‚Äôll see progress here.
        </div>

        <div class="links">
          <a id="downloadBtn" href="#" style="display:none;" download>‚¨á Download MP4</a>
          <button id="deleteBtn" class="dangerBtn" style="display:none;" onclick="deleteVideo()">üóë Delete Video</button>
        </div>

        <video id="videoPlayer" controls></video>

        <div class="emptyState" id="emptyState">
          <div>
            <div class="spark">üé¨</div>
            Your video preview will appear here.<br/>
            <span style="opacity:.7;font-size:12px;font-weight:900">
              Rendering progress will update automatically.
            </span>
          </div>
        </div>

      </div>

    </div>
  </div>

</div>
<script src="../config.js"></script>

<script>
  console.log("CONFIG:", window.APP_CONFIG);
</script>
<script>  
  const API_BASE = window.APP_CONFIG?.API_BASE || "https://backend-abhyaas-final.onrender.com";
  let currentVideoId = null;
  let pollInterval = null;

  const statusText = document.getElementById("statusText");
  const statusHint = document.getElementById("statusHint");
  const progressBar = document.getElementById("progressBar");
  const videoPlayer = document.getElementById("videoPlayer");
  const downloadBtn = document.getElementById("downloadBtn");
  const deleteBtn = document.getElementById("deleteBtn");
  const renderBtn = document.getElementById("renderBtn");
  const emptyState = document.getElementById("emptyState");

  async function startRender(){
    const topic = document.getElementById("topic").value.trim();
    const grade = document.getElementById("grade").value;
    const language = document.getElementById("language").value;

    if(!topic){ alert("Please enter a topic!"); return; }
    if(!grade){ alert("Please select grade!"); return; }
    if(!language){ alert("Please select language!"); return; }

    // reset UI
    statusText.innerText="Status: Starting...";
    statusHint.innerText="Writing script + planning scenes‚Ä¶";
    progressBar.style.width="5%";

    videoPlayer.style.display="none";
    videoPlayer.src = "";
    downloadBtn.style.display="none";
    deleteBtn.style.display="none";
    emptyState.style.display="flex";

    renderBtn.disabled = true;
    renderBtn.innerText = "‚è≥ Generating...";

    try{
      const res = await fetch(`${BACKEND}/render-video`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({topic,grade:parseInt(grade),language})
      });

      const data = await res.json();
      if(!res.ok) throw new Error(data.detail || "Render start failed");

      currentVideoId = data.video_id;

      if(pollInterval) clearInterval(pollInterval);
      pollInterval = setInterval(checkStatus, 2000);

    }catch(e){
      alert("Error: " + (e.message || e));
      renderBtn.disabled = false;
      renderBtn.innerText = "üöÄ Generate Video";
    }
  }

  async function checkStatus(){
    if(!currentVideoId) return;

    try{
      const res = await fetch(`${BACKEND}/status/${currentVideoId}`);
      const data = await res.json();

      statusText.innerText = `Status: ${data.status} (${data.progress}%)`;
      progressBar.style.width = data.progress + "%";

      if(data.progress < 25) statusHint.innerText = "Writing script + planning scenes‚Ä¶";
      else if(data.progress < 55) statusHint.innerText = "Generating narration + visuals‚Ä¶";
      else if(data.progress < 85) statusHint.innerText = "Rendering final MP4‚Ä¶";
      else statusHint.innerText = "Almost done‚Ä¶";

      if(data.status === "DONE"){
        clearInterval(pollInterval);

        const videoUrl = `${BACKEND}/video/${currentVideoId}`;

        emptyState.style.display="none";
        videoPlayer.style.display="block";
        videoPlayer.src = videoUrl;

        downloadBtn.style.display="inline-flex";
        downloadBtn.href = videoUrl;

        deleteBtn.style.display="inline-flex";

        renderBtn.disabled = false;
        renderBtn.innerText = "‚ú® Generate Another Video";
      }

      if(data.status === "FAILED"){
        clearInterval(pollInterval);
        renderBtn.disabled = false;
        renderBtn.innerText = "üöÄ Generate Video";
        alert("Video generation failed: " + (data.error || "Unknown error"));
      }

    }catch(e){
      // ignore occasional network errors
    }
  }

  async function deleteVideo(){
    if(!currentVideoId) return;
    if(!confirm("Delete this video?")) return;

    await fetch(`${BACKEND}/video/${currentVideoId}`,{ method:"DELETE" });

    alert("Deleted!");

    videoPlayer.style.display="none";
    downloadBtn.style.display="none";
    deleteBtn.style.display="none";
    emptyState.style.display="flex";

    statusText.innerText="Status: Deleted";
    statusHint.innerText="You can generate a new video anytime.";
    progressBar.style.width="0%";
  }
</script>

</body>
</html>